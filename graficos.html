<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Painel ‚Äì Cartas de Controle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0b0d; --fg:#e9eef3; --muted:#9aa4ad; --glass:rgba(255,255,255,.06);
      --accent:#4da3ff; --accent-2:#7bd389; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:500 15px/1.5 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .bar{
      display:flex;align-items:center;gap:14px; padding:12px 18px;
      background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
      border-bottom:1px solid rgba(255,255,255,.08); position:sticky; top:0; z-index:3;
    }
    .title{font-weight:700; letter-spacing:.3px}
    .title .small{color:var(--muted); font-weight:600; margin-left:8px}
    .blink3{animation:blink3 .9s ease-in-out 3}
    @keyframes blink3{0%,100%{opacity:1} 50%{opacity:.15}}
    .spacer{flex:1}
    .wrap{max-width:1180px;margin:0 auto;padding:10px 16px}
    .frame-box{
      background:var(--glass); border:1px solid rgba(255,255,255,.08);
      border-radius:14px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.25);
      min-height:70vh; display:flex; align-items:stretch; justify-content:center;
    }
    iframe{width:100%; height:78vh; border:0; background:#fff}
    .controls{
      position:sticky; bottom:0; z-index:3;
      display:flex; gap:10px; align-items:center; justify-content:center;
      padding:10px; background:linear-gradient(180deg,rgba(0,0,0,.0),rgba(0,0,0,.35));
      border-top:1px solid rgba(255,255,255,.08);
    }
    .btn{
      background:var(--glass); border:1px solid rgba(255,255,255,.14);
      color:var(--fg); padding:8px 12px; border-radius:999px; cursor:pointer;
      font-weight:600; min-width:84px; transition:transform .06s ease, background .2s ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.active{background:rgba(77,163,255,.15); border-color:rgba(77,163,255,.4)}
    .pill{padding:6px 10px; background:var(--glass); border-radius:999px; border:1px solid rgba(255,255,255,.12)}
    select{background:transparent; color:var(--fg); border:0; font-weight:600; outline:none}
    .counter{color:var(--muted); font-weight:700}
    @media (max-width:900px){
      iframe{height:72vh}
      .btn{min-width:64px;padding:8px 10px}
    }
  </style>
</head>
<body>

  <div class="bar">
    <div class="title" id="barTitle">Carregando‚Ä¶</div>
    <div class="title small" id="barSubtitle"></div>
    <div class="spacer"></div>
    <div class="counter" id="counter">0/0</div>
  </div>

  <div class="wrap">
    <div class="frame-box">
      <iframe id="viewer" src="about:blank" loading="eager" referrerpolicy="no-referrer"></iframe>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="prevBtn">‚Üê Anterior</button>
    <button class="btn active" id="playBtn">‚èµ Play</button>
    <button class="btn" id="nextBtn">Pr√≥ximo ‚Üí</button>

    <span class="pill"><span id="idxPill">‚Äî</span></span>

    <span class="pill">
      <select id="speedSel" aria-label="Velocidade">
        <option value="30000">30s</option>
        <option value="60000" selected>60s</option>
        <option value="90000">90s</option>
        <option value="120000">120s</option>
      </select>
    </span>

    <span class="pill">
      <select id="grupoSel" aria-label="Grupo">
        <option value="todos" selected>TODOS</option>
        <!-- mant√©m para futuro (se quiser filtrar por grupo) -->
      </select>
    </span>
  </div>

  <script>
    /* ============================================================
       üîß CONFIGURA TUAS FONTES AQUI (se j√° tens no teu script, mant√©m)
       Cada item pode ter:
       - nome: o texto como est√° no Drive/GitHub (ex.: "Carta controle - TURBIDEZ")
       - src : a URL publicada (iframe/planilha/gr√°fico/imagem)
       üëâ O t√≠tulo mostrado ser√° sempre a **parte depois do tra√ßo** de `nome` (ou da pr√≥pria URL se nome n√£o vier).
       ============================================================ */
    const PAINEIS = [
      // EXEMPLOS ‚Äî substitui pelos teus (ou deixa que j√° funciona com os que tiverem a√≠):
      { nome: "Carta controle - PH4",      src: "https://docs.google.com/spreadsheets/d/e/2PACX-EXEMPLO/pubhtml?gid=1&single=true" },
      { nome: "Carta controle - PH7",      src: "https://docs.google.com/spreadsheets/d/e/2PACX-EXEMPLO/pubhtml?gid=2&single=true" },
      { nome: "Carta controle - PH10",     src: "https://docs.google.com/spreadsheets/d/e/2PACX-EXEMPLO/pubhtml?gid=3&single=true" },
      { nome: "Carta controle - CLORETOS", src: "https://docs.google.com/spreadsheets/d/e/2PACX-EXEMPLO/pubhtml?gid=4&single=true" },
      { nome: "Carta controle - TURBIDEZ", src: "https://docs.google.com/spreadsheets/d/e/2PACX-EXEMPLO/pubhtml?gid=5&single=true" },
      { nome: "Carta controle - DUREZA",   src: "https://docs.google.com/spreadsheets/d/e/2PACX-EXEMPLO/pubhtml?gid=6&single=true" },
      // ‚Ä¶podes ter quantos quiseres
    ];

    /* ============================================================
       üß† Fun√ß√£o que EXTRAI o t√≠tulo correto (depois do tra√ßo)
       - Aceita ‚Äú - ‚Äù ou ‚Äú ‚Äì ‚Äù (tra√ßo normal ou en-dash)
       - Se n√£o houver nome, tenta deduzir do arquivo na URL
       - Remove extens√£o (.csv, .png, etc) e espa√ßos extras
       ============================================================ */
    function deriveTitleFrom(anyStringOrUrl){
      if(!anyStringOrUrl) return "SEM T√çTULO";
      let s = decodeURIComponent(String(anyStringOrUrl)).trim();

      // Se veio URL, fica s√≥ com o final do caminho
      if (/^https?:\/\//i.test(s)) {
        s = s.replace(/^.*\//, '');               // pega s√≥ o √∫ltimo segmento
        s = s.replace(/\?.*$/, '').replace(/#.*$/,''); // sem query/hash
      }

      // Tira extens√£o
      s = s.replace(/\.[a-z0-9]{1,6}$/i, '');

      // Quebra por ‚Äú-‚Äù ou ‚Äú‚Äì‚Äù
      const parts = s.split(/\s*[‚Äì-]\s*/);
      const last = parts[parts.length - 1];

      return (last || s).toUpperCase().trim();
    }

    // Se tiveres um campo "grupo" nos teus itens, podes filtrar aqui:
    function getActiveList(){
      // por enquanto retorna todos
      return PAINEIS.slice();
    }

    /* =========================
       üéõÔ∏è Navega√ß√£o e Rota√ß√£o
       ========================= */
    const viewer = document.getElementById('viewer');
    const barTitle = document.getElementById('barTitle');
    const barSubtitle = document.getElementById('barSubtitle');
    const counter = document.getElementById('counter');
    const idxPill = document.getElementById('idxPill');
    const speedSel = document.getElementById('speedSel');
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    let list = getActiveList();
    let i = 0;
    let timer = null;

    function updateBar(){
      const total = list.length;
      counter.textContent = `${i+1}/${total}`;
      idxPill.textContent = counter.textContent;

      // T√≠tulo grande = ‚ÄúCONDUTIVIDADE (2/7)‚Äù ou o que preferir
      // Aqui mantenho ‚ÄúCarta de Controle ‚Äì NOME‚Äù no subt√≠tulo e mostra o √≠ndice no topo.
      const tituloMaior = deriveTitleFrom(list[i].nome || list[i].src);
      barTitle.textContent = tituloMaior;
      barTitle.classList.remove('blink3'); // reinicia o efeito de ‚Äúpiscar 3x‚Äù
      void barTitle.offsetWidth;           // reflow para permitir re-animar
      barTitle.classList.add('blink3');

      barSubtitle.textContent = `Carta de Controle ‚Äì ${tituloMaior}`;
    }

    function show(idx){
      if (!list.length) return;
      i = ((idx % list.length) + list.length) % list.length;
      viewer.src = list[i].src;
      updateBar();
    }

    function play(){
      stop();
      playBtn.classList.add('active');
      const ms = parseInt(speedSel.value, 10) || 60000;
      timer = setInterval(() => next(), ms);
    }
    function stop(){
      playBtn.classList.remove('active');
      if (timer) { clearInterval(timer); timer = null; }
    }
    function togglePlay(){
      if (timer) stop(); else play();
    }
    function prev(){ show(i-1); }
    function next(){ show(i+1); }

    // Eventos
    playBtn.addEventListener('click', togglePlay);
    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);
    speedSel.addEventListener('change', () => { if (timer) play(); });

    // Inicializa√ß√£o
    list = getActiveList();
    if (!list.length){
      viewer.srcdoc = "<div style='padding:24px;font:16px sans-serif'>Nenhum painel configurado.</div>";
    } else {
      show(0);
      play(); // inicia rodando como est√° no teu painel
    }

    /* ===========================================
       üí° Caso tu j√° tenha uma lista pr√≥pria no JS:
       - Mant√©m tua estrutura/estilos e substitui APENAS:
         1) a fun√ß√£o deriveTitleFrom() (igual acima)
         2) onde defines o texto do t√≠tulo, usa:
              const titulo = deriveTitleFrom(nomeOuUrl);
              barTitle.textContent = titulo;
              barSubtitle.textContent = `Carta de Controle ‚Äì ${titulo}`;
       =========================================== */
  </script>
</body>
</html>
